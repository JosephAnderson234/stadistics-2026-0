---
title: "Asesoria R"
format: html
editor: visual
---

Explorar en **R** el [archivo de datos sobre bodegas](https://drive.google.com/file/d/1c27kp6lz4gPvuomx0BWl4LIL9-qjn_FT/view?usp=sharing) en diversos distritos de Lima.

En el archivo encontrarÃ¡n los siguientes campos:

-   `Bodega`: una cadena de caracteres que representa a la bodega. El nombre real de la bodega ha sido ofuscado por razones de confidencialidad.

-   `Distrito`: una cadena de caracteres que representa el distrito donde estÃ¡ ubicada la bodega.

-   `Aforo`: un entero positivo con el aforo de la bodega.

-   `Productos`: un entero positivo con la cantidad de tipos de productos diferentes que manejÃ³ la bodega un mes. Marcas diferentes y presentaciones diferentes cuentan como productos diferentes. Los diversos tipos de verduras y frutas cuentan como tipos diferentes.

-   `Ventas1`: La cantidad total (en soles con cÃ©ntimos) vendida por la bodega en la primera semana del estudio. No se toman en cuenta las devoluciones.

-   `Ventas2`: La cantidad total (en soles con cÃ©ntimos) vendida por la bodega en la segunda semana del estudio. No se toman en cuenta las devoluciones.

-   `Ventas3`: La cantidad total (en soles con cÃ©ntimos) vendida por la bodega en la tercera semana del estudio. No se toman en cuenta las devoluciones.

-   `Ventas4`: La cantidad total (en soles con cÃ©ntimos) vendida por la bodega en la cuarta semana del estudio. No se toman en cuenta las devoluciones.

El conjunto de datos estÃ¡ limpio, pero la limpieza generÃ³ algunos datos faltantes en las ventas, estos se reportan como NA. Estructuras necesarias

Para trabajar se necesitarÃ¡ los siguientes dataframes:

**El dataframe DF**

Este dataframe contiene todos los datos del archivo ***BodegasEP.csv*** y se debe cargar directamente mediante la funciÃ³n `read_csv`. Para poder hacer esto deben tener el archivo en una ubicaciÃ³n conocida, preferiblemente el directorio de trabajo y saber como trabajar con la codificaciÃ³n UTF-8 que permite el manejo de caracteres especiales como la Ã± o las diversas letras acentuadas.

Recuerden que la funciÃ³n str puede ser Ãºtil para entender los diversos detalles de una estructura en R.

La funciÃ³n complete.cases tambiÃ©n es conveniente pues permite detectar en donde hay observaciones faltantes, de manera similar a is.na.

**El dataframe DFT**

Este dataframe se crea a partir de DF usando la funciÃ³n complete.cases para eliminar los registros con datos faltantes y usando la funciÃ³n cbind para anexar una columna adicional donde se encuentra la suma de las columnas Ventas1, Ventas2, Ventas3 y Ventas4.

De esta manera DFT tiene una columna mÃ¡s que DF y algunas filas menos que DF.

La funciÃ³n stri_length podrÃ­a ser Ãºtil para manipular algunas cosas relacionadas con DFT.

**El dataframe DFD**

Este dataframe se obtiene a partir de DFT utilizando la funciÃ³n aggregate.

En DFD deberÃ­an haber solo dos columnas (dos variables). La primera es el Distrito, que es el valor que hemos utilizado para sumar las ventas mensuales. La segunda es Total Ventas y tiene los valores acumulados de las ventas, por distrito.

En el caso de las filas, DFD tambiÃ©n tiene pocas, ya que en realidad trabaja con el nÃºmero de distritos disponibles en el estudio.

> Pasos que se recomiendan seguir antes de su examen:

-   Tener ya un qmd con lo siguiente: Carga de librerÃ­as, funciÃ³n para redondeo y el comando para leer archivos *read_csv*

-   Guardar el archivo con el que se vaya a trabajar el L1, en el mismo lugar en el que estÃ¡ su qmd.

-   Asegurarse que en toda la ruta de trabajo no hayan acentos ni caracteres especiales.

```{r}
library('tidyverse')
```

```{r}
DF <- read_csv('./BodegasEP.csv')
```

```{r}
DF<- read_csv("BodegasEP - BodegasEP (1).csv")
DF
```

# 

## 1ï¸âƒ£ Â¿CuÃ¡ntas variables numÃ©ricas tiene el data frame?

```{r}
DF %>% select(where(is.numeric)) %>% ncol() 
```

**Resultado:**\
ğŸ‘‰ **6 variables numÃ©ricas**

**ExplicaciÃ³n:**

-   `where(is.numeric)` selecciona solo columnas numÃ©ricas

-   `ncol()` cuenta cuÃ¡ntas columnas resultan\
    (Aforo, Productos, Ventas1â€“Ventas4)

## 2ï¸âƒ£ Â¿CuÃ¡ntos niveles tiene el factor Distrito?

```{r}
length(unique(DF$Distrito)) 
```

**Resultado:**\
ğŸ‘‰ **28 distritos**

**ExplicaciÃ³n:**

-   `unique()` obtiene los valores distintos

-   `length()` cuenta cuÃ¡ntos hay

## 3ï¸âƒ£ Â¿CuÃ¡ntas bodegas participaron en el estudio?

```{r}
length(unique(DF$Bodega)) 
```

**Resultado:**\
ğŸ‘‰ **11 053 bodegas**

**ExplicaciÃ³n:**\
Cada fila corresponde a una bodega distinta (no hay repetidas).

## 4ï¸âƒ£ Â¿CuÃ¡ntos datos faltantes hay?

```         
sum(is.na(DF)) 
```

**Resultado:**\
ğŸ‘‰ **11 valores NA**

**ExplicaciÃ³n:**

-   `is.na()` genera una matriz lÃ³gica

-   `sum()` cuenta los TRUE

## 5ï¸âƒ£ Â¿A cuÃ¡ntas bodegas afectan los datos faltantes?

```         
sum(!complete.cases(DF)) 
```

**Resultado:**\
ğŸ‘‰ **11 bodegas**

**ExplicaciÃ³n:**\
Cada NA afecta a una bodega distinta.

## 6ï¸âƒ£ Â¿CuÃ¡ntas bodegas tienen todos sus datos completos?

```         
sum(complete.cases(DF)) 
```

**Resultado:**\
ğŸ‘‰ **11 042 bodegas**

# ğŸ“Š Dataframe **DFT**

Se eliminan los registros incompletos y se agrega la venta mensual total.

```{r}
DFT <- DF %>%    filter(complete.cases(.)) %>%   mutate(Tventas = rowSums(across(Ventas1:Ventas4))) 

```

**ExplicaciÃ³n:**

-   `filter(complete.cases(.))` elimina filas con NA

-   `rowSums()` suma las ventas semanales

-   `across()` selecciona columnas consecutivas

## 7ï¸âƒ£ Â¿CuÃ¡ntas bodegas completas participaron en **Miraflores**?

```{r}
DFT %>% filter(Distrito == "Miraflores") %>% nrow() 
```

**Resultado:**\
ğŸ‘‰ **140 bodegas**

## 8ï¸âƒ£ Â¿CuÃ¡ntas bodegas completas participaron en **BreÃ±a**?

```{r}
DFT %>% filter(Distrito == "BreÃ±a") %>% nrow() 

```

**Resultado:**\
ğŸ‘‰ **113 bodegas**

## 9ï¸âƒ£ Â¿CuÃ¡l es el **total de ventas** en todo el estudio?

```{r}
sum(DFT$Tventas) 
```

**Resultado:**\
ğŸ‘‰ **S/ 111,989,290.90**

## ğŸ”Ÿ Â¿En quÃ© distrito estÃ¡ la **bodega con mayor venta semanal**?

### Â¿CÃ³mo se llama?

```{r}
DFT %>%    mutate(MaxS = pmax(Ventas1, Ventas2, Ventas3, Ventas4)) %>%   slice(which.max(MaxS)) 
```

**Resultado:**

-   ğŸ™ **Distrito:** Chorrillos

-   ğŸª **Bodega:** *guisopillo escorredero*

-   ğŸ’° **Venta semanal mÃ¡xima:** S/ 6,919.14

**ExplicaciÃ³n:**

-   `pmax()` obtiene la venta mÃ¡xima semanal por bodega

-   `which.max()` encuentra la mayor

## 1ï¸âƒ£1ï¸âƒ£ Â¿Bodega con **menor venta semanal**?

```{r}
DFT %>%    mutate(MaxS = pmax(Ventas1, Ventas2, Ventas3, Ventas4)) %>%   slice(which.min(MaxS)) 
```

**Resultado:**

-   ğŸ™ San Juan de Lurigancho

-   ğŸª *automÃ¡tico sarcocarpio*

-   ğŸ’° S/ 877.07

## 1ï¸âƒ£2ï¸âƒ£ Â¿Bodega con **mayor venta mensual**?

```{r}
DFT %>% slice(which.max(Tventas)) 
```

**Resultado:**

-   ğŸ™ Miraflores

-   ğŸª *paraliticarse calvicie*

-   ğŸ’° S/ 23,644.20

## 1ï¸âƒ£3ï¸âƒ£ Â¿Bodega con **menor venta mensual**?

```{r}
DFT %>% slice(which.min(Tventas)) 
```

**Resultado:**

-   ğŸ™ San Juan de Miraflores

-   ğŸª *procesionalmente deprimir*

-   ğŸ’° S/ 3,030.51

# ğŸ“ Dataframe **DFD** â€“ Ventas por distrito

```{r}
DFD <- DFT %>%    group_by(Distrito) %>%    summarise(Tvd = sum(Tventas)) 
```

## 1ï¸âƒ£4ï¸âƒ£ Â¿QuÃ© distrito tuvo **mayores ventas**?

```{r}
DFD %>% arrange(desc(Tvd)) %>% slice(1) 
```

**Resultado:**\
ğŸ‘‰ **San Juan de Lurigancho** â€“ S/ 14,982,198.11

## 1ï¸âƒ£5ï¸âƒ£ Â¿QuÃ© distrito tuvo **menores ventas**?

```{r}
DFD %>% arrange(Tvd) %>% slice(1) 
```

**Resultado:**\
ğŸ‘‰ **Santa Rosa** â€“ S/ 345,077.67

## 1ï¸âƒ£6ï¸âƒ£ Â¿QuÃ© bodega tiene el **nombre mÃ¡s largo** y cuÃ¡nto vendiÃ³?

```{r}
DFT %>%    mutate(largo = str_length(Bodega)) %>%   slice(which.max(largo)) 
```

**Resultado:**

-   ğŸª *estruendosamente desherrumbramiento*

-   ğŸ™ San Juan de Lurigancho

-   ğŸ’° S/ 4,419.03

**ExplicaciÃ³n:**

-   `str_length()` cuenta caracteres

-   `which.max()` selecciona el nombre mÃ¡s largo
