---
title: "Asesoria R"
format: html
editor: visual
---

Explorar en **R** el [archivo de datos sobre bodegas](https://drive.google.com/file/d/1c27kp6lz4gPvuomx0BWl4LIL9-qjn_FT/view?usp=sharing) en diversos distritos de Lima.

En el archivo encontrarán los siguientes campos:

-   `Bodega`: una cadena de caracteres que representa a la bodega. El nombre real de la bodega ha sido ofuscado por razones de confidencialidad.

-   `Distrito`: una cadena de caracteres que representa el distrito donde está ubicada la bodega.

-   `Aforo`: un entero positivo con el aforo de la bodega.

-   `Productos`: un entero positivo con la cantidad de tipos de productos diferentes que manejó la bodega un mes. Marcas diferentes y presentaciones diferentes cuentan como productos diferentes. Los diversos tipos de verduras y frutas cuentan como tipos diferentes.

-   `Ventas1`: La cantidad total (en soles con céntimos) vendida por la bodega en la primera semana del estudio. No se toman en cuenta las devoluciones.

-   `Ventas2`: La cantidad total (en soles con céntimos) vendida por la bodega en la segunda semana del estudio. No se toman en cuenta las devoluciones.

-   `Ventas3`: La cantidad total (en soles con céntimos) vendida por la bodega en la tercera semana del estudio. No se toman en cuenta las devoluciones.

-   `Ventas4`: La cantidad total (en soles con céntimos) vendida por la bodega en la cuarta semana del estudio. No se toman en cuenta las devoluciones.

El conjunto de datos está limpio, pero la limpieza generó algunos datos faltantes en las ventas, estos se reportan como NA. Estructuras necesarias

Para trabajar se necesitará los siguientes dataframes:

**El dataframe DF**

Este dataframe contiene todos los datos del archivo ***BodegasEP.csv*** y se debe cargar directamente mediante la función `read_csv`. Para poder hacer esto deben tener el archivo en una ubicación conocida, preferiblemente el directorio de trabajo y saber como trabajar con la codificación UTF-8 que permite el manejo de caracteres especiales como la ñ o las diversas letras acentuadas.

Recuerden que la función str puede ser útil para entender los diversos detalles de una estructura en R.

La función complete.cases también es conveniente pues permite detectar en donde hay observaciones faltantes, de manera similar a is.na.

**El dataframe FD**

Este dataframe se crea a partir de DF usando la función complete.cases para eliminar los registros con datos faltantes y usando la función cbind para anexar una columna adicional donde se encuentra la suma de las columnas Ventas1, Ventas2, Ventas3 y Ventas4.

De esta manera DFT tiene una columna más que DF y algunas filas menos que DF.

La función stri_length podría ser útil para manipular algunas cosas relacionadas con DFT.

**El dataframe FDT**

Este dataframe se obtiene a partir de DFT utilizando la función aggregate.

En DFD deberían haber solo dos columnas (dos variables). La primera es el Distrito, que es el valor que hemos utilizado para sumar las ventas mensuales. La segunda es Total Ventas y tiene los valores acumulados de las ventas, por distrito.

En el caso de las filas, DFD también tiene pocas, ya que en realidad trabaja con el número de distritos disponibles en el estudio.

> Pasos que se recomiendan seguir antes de su examen:

-   Tener ya un qmd con lo siguiente: Carga de librerías, función para redondeo y el comando para leer archivos *read_csv*

-   Guardar el archivo con el que se vaya a trabajar el L1, en el mismo lugar en el que está su qmd.

-   Asegurarse que en toda la ruta de trabajo no hayan acentos ni caracteres especiales.

```{r}
library(readr)
library(plyr)
library(dplyr)
library(tidyr)
library(tidyverse)
library(ggplot2)
```

```{r}
DF <- read_csv('BodegasEP.csv')
DF
```

```{r}
DF<- read_csv("BodegasEP - BodegasEP (1).csv")
DF
```

# ¿Cuántas variables numéricas tiene el *data frame*?

```{r}
glimpse(DF)
6
#sum(sapply(DF, is.numeric)) what is the number of them are numeric
#sapply(DF, is.numeric) who are them

```

# ¿Cuántos niveles tiene el factor *Distrito*?

```{r}
length(unique(DF$Distrito))
```

```{r}
unique(DF$Distrito)
```

```{r}
count(DF,Distrito)
```

```{r}
DF %>% count(Distrito)
```

# ¿Cuántas bodegas participaron en el estudio?

```{r}
smr <- count(DF,Bodega)
smr
#sum(smr$n)
```

```{r}
DF %>% count(Bodega) 
```

Se infiere que todas las bodegas que participaron son unicas.

# ¿Cuántos datos faltantes hay?

```{r}
sum(is.na(DF))
```

-   ¿A cuántas bodegas afectan?

```{r}
sum(!complete.cases(DF))
```

Se infiere que cada bodega tiene 1 dato faltante en alguna variable

# ¿Cuántas bodegas tienen todos sus datos completos?

```{r}
sum(complete.cases(DF))
```

**El dataframe DFT**

Este dataframe se crea a partir de DF usando la función complete.cases para eliminar los registros con datos faltantes y usando la función cbind para anexar una columna adicional donde se encuentra la suma de las columnas Ventas1, Ventas2, Ventas3 y Ventas4.

De esta manera DFT tiene una columna más que DF y algunas filas menos que DF.

La función stri_length podría ser útil para manipular algunas cosas relacionadas con DFT.

```{r}
mutate(filter(DF,complete.cases(DF)),Tventas=rowSums(across(Ventas1:Ventas4)))
```

```{r}
DFT <- DF %>% 
  filter(complete.cases(.)) %>%
  mutate(Tventas=rowSums(across(Ventas1:Ventas4)))
DFT
```

# ¿Cuántas bodegas, con todos sus datos completos, participaron en Miraflores?

```{r}
DFT %>% filter(Distrito=='Miraflores')
```

&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&

# ¿Cuántas bodegas, con todos sus datos completos, participaron en Breña?

```{r}
count(DF, Distrito)
```

Hay 113 bodegas en breña

# ¿Cuál es el total de ventas en todos los distritos?

```{r}
sum(DFT$Tventas)
```

-   si la pregunta fuera total de ventas por distrito

```{r}
summarise(group_by(DFT, Distrito), TVD=sum(Tventas))
```

```{r}
DFT %>% group_by(Distrito) %>% summarise(Tvd=sum(Tventas))
```

# ¿En qué distrito está la bodega con mayor venta semanal? ¿Cómo se llama esa bodega?

```{r}
DFT %>% 
  mutate(MaxS=pmax(Ventas1,Ventas2,Ventas3,Ventas4)) %>% 
  arrange(desc(MaxS))
```

```{r}
DFT %>% 
  mutate(MaxS=pmax(Ventas1,Ventas2,Ventas3,Ventas4)) %>% 
  slice(which.max(MaxS))
```

```{r}
which(DFT$Productos==46)
```

```{r}
DFT %>% slice(2)
```

# ¿En qué distrito esta la bodega con menor venta semanal? ¿Cómo se llama esa bodega?

# ¿En qué distrito está la bodega con mayor venta mensual? ¿Cómo se llama esa bodega?

```{r}
DFT %>% slice(which.max(Tventas))
```

# ¿En qué distrito esta la bodega con menor venta mensual? ¿Cómo se llama esa bodega?

# ¿Qué distrito tiene las mayores ventas en el estudio?

```{r}
DFD <- DFT %>% group_by(Distrito) %>% summarise(Tvd=sum(Tventas))
```

```{r}
DFD %>% arrange(desc(Tvd))
```

# ¿Qué distrito tiene las menores ventas en el estudio?

# ¿Qué bodega tiene el nombre más largo? ¿Cúanto vendió?

```{r}
DFT %>% 
  mutate(cant_car=str_length(Bodega)) %>%
  slice(which.max(cant_car))
```
